@using SarasBlogg.Extensions
@{
}
@model SarasBlogg.ViewModels.BloggViewModel

<div class="container-site">
	@if (Model.Blogg == null || Model.Blogg.Hidden)
	{
		var filteredBloggs = Model.IsArchiveView
		? Model.Bloggs.Where(b => b.IsArchived && !b.Hidden && b.LaunchDate <= DateTime.Today)
		: Model.Bloggs.Where(b => !b.IsArchived && !b.Hidden && b.LaunchDate <= DateTime.Today);

		foreach (var blogg in filteredBloggs)
		{
			<a asp-route-showId="@blogg.Id" class="text-decoration-none text-dark blogg-link" Id="reloadPageFormSection-@blogg.Id" data-blogg-id="@blogg.Id">
				<div class="card m-2 shadow-lg card mx-auto">
					<div class="card-body">
						<img class="card-img-top mb-4 shadow-lg" src="~/img/@blogg.Image" />
						<h5 class="card-title">@blogg.Title</h5>
						<p class="card-text">@blogg.Content.LimitLength(120)</p>
						<p class="text-muted"><small class="text-muted">Publicerad: @blogg.LaunchDate.ToString("yyyy-MM-dd")</small></p>
					</div>
				</div>
			</a>
			<hr class="m-5 border" />
		}
	}
	else
	{
		<div class="card-body" id="bloggTopSection">
			<div class="card-body">
				<img class="card-img-top mb-3 rounded shadow-lg object-fit-cover bloggimg" src="~/img/@Model.Blogg.Image" alt="Blogg image" />
				<h3 class="card-title">@Model.Blogg.Title</h3>
				<p class="card-text linebreak">@Model.Blogg.Content</p>
				<p class="text-muted">
					<strong>Författare:</strong> @Model.Blogg.Author<br />
					<strong>Publicerad:</strong> @Model.Blogg.LaunchDate.ToString("yyyy-MM-dd")
				</p>
			</div>
		</div>
		@if (Model.AllComments != null && Model.AllComments.Any((c => c.BloggId == Model.Blogg.Id)))
		{
			<div class="comments-section mt-4">
				<h5>Kommentarer</h5>
				@foreach (var comment in Model.AllComments)
				{
					<div class="card mb-2">
						<div class="card-body">
							<strong>@comment.Name</strong> <span class="text-muted">(@comment.CreatedAt.ToString("yyyy-MM-dd HH:mm"))</span>
							<p>@comment.Content</p>
						</div>
					</div>
				}
			</div>
		}
		else
		{
			<p class="text-muted">Inga kommentarer ännu.</p>
		}

	}
</div>
@if (Model.Blogg != null)
{
	<div id="stickyBackPanel" class="sticky-back-panel" style="display:none;">
		<div id="stickyBackPanel" class="sticky-back-panel d-flex align-items-center" style="display:none;">
				<button onclick="reloadCurrentPage(@Model.Blogg.Id)" class="btn btn-dark me-2" style="cursor: pointer; font-weight: bold;" enabled>
                &lt;
            </button>
            <button class="btn btn-dark" style="cursor: pointer; opacity: 0.5;" disabled>
                &gt;
            </button>
        </div>
	</div>
}