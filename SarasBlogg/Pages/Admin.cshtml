@page
@using Extensions
@model SarasBlogg.Pages.AdminModel
@inject SignInManager<IdentityUser> SignInManager
@{
	<br />
}

@if (SignInManager.IsSignedIn(User))
{
	// LISTA PUBLICERADE BLOGGAR
	<h2>Lista Publicerade Bloggar</h2>
	if (Model.Bloggs != null && Model.Bloggs.Any(b => !b.Hidden))
	{
		<table class="border table table-striped shadow-sm align-middle">
			<thead>
				<tr>
					<th class="text-center align-middle border d-none d-md-table-cell" colspan="3">Knappar</th>
					<th class="text-center align-middle border d-md-none" colspan="1">Knappar</th>
                    <th class="text-center align-middle border">Id</th>
                    <th class="text-center align-middle border">Titel</th>
                    <th class="text-center align-middle border">Innehåll</th>
                    <th class="text-center align-middle border">Författare</th>
                    <th class="text-center align-middle border">Lanserings Datum</th>
                    <th class="text-center align-middle border">Bild</th>
				</tr>
			</thead>
			@foreach (var blogg in Model.Bloggs.Where(b => !b.Hidden))
			{
				<tr>

					<td class="text-center align-middle">
						<form method="get">
							<input type="hidden" name="hiddenId" value="@blogg.Id" />
							<button type="submit" class="btn btn-outline-warning">Dölj</button>
						</form>
					</td>
					<td class ="text-center align-middle">
						@if (blogg.IsArchived)
						{
							<a asp-route-archiveId="@blogg.Id" class="btn btn-outline-warning">Arkiverad</a>
						}
						else
						{
							<a asp-route-archiveId="@blogg.Id" class="btn btn-outline-success">Publicerad</a>
						}
					</td>
					<td class="text-center align-middle">
						<a asp-route-editId="@blogg.Id" class="btn btn-outline-primary">Ändra</a>

					</td>




					<td class="text-center align-middle border">@blogg.Id</td>
					<td class="text-lg-start align-middle border">@blogg.Title</td>
					<td class="text-lg-start align-middle border">@blogg.Content.LimitLength(10)</td>
					<td class="text-center align-middle border">@blogg.Author</td>
					<td class="text-center align-middle border">
						<span style="color: @(blogg.LaunchDate.Date > DateTime.Today ? "orange" : "green")">
							@blogg.LaunchDate.ToString("yyyy-MM-dd")
						</span>
					</td>
					<td class="text-center align-middle border">
						<img class="card-img-top admin-blog-img " src="~/img/@blogg.Image" />
					</td>
				</tr>
			}
		</table>
	}
	else
	{
		<p>Ingen blogg finns att visa.</p>
	}

	<br />
	<hr class="m-1 border" />
	<br />

	// FORMULÄR FÖR NY BLOGG / ÄNDRING
	<div id="editFormSection">
	<form class="p-3 border rounded shadow-sm" method="post" enctype="multipart/form-data">
		<input asp-for="NewBlogg.Id" type="hidden" />
		<input asp-for="NewBlogg.UserId" type="hidden" />
		<label asp-for="NewBlogg.Title"></label>
		<input asp-for="NewBlogg.Title" class="form-control" placeholder="Ange bloggtitel här" maxlength="100" />
		<span asp-validation-for="NewBlogg.Title" class="text-danger"></span>
		<br />
		<label asp-for="NewBlogg.Content"></label>
		<textarea asp-for="NewBlogg.Content" class="form-control" placeholder="Ange innehåll här" rows="10" cols="60"></textarea>
		<span asp-validation-for="NewBlogg.Content" class="text-danger"></span>
		<br />
		<label asp-for="NewBlogg.Author"></label>
		<input asp-for="NewBlogg.Author" class="form-control" placeholder="Ange författare här" maxlength="100" />
		<span asp-validation-for="NewBlogg.Author" class="text-danger"></span>
		<br />
		<label asp-for="NewBlogg.LaunchDate"></label>
		<input asp-for="NewBlogg.LaunchDate" class="form-control" value="@(Model.NewBlogg.LaunchDate == default ? DateTime.Today.ToString("yyyy-MM-dd") : Model.NewBlogg.LaunchDate.ToString("yyyy-MM-dd"))" />
		<span asp-validation-for="NewBlogg.LaunchDate" class="text-danger"></span>
		<br />
		<!-- Bildhantering -->
		<label asp-for="NewBlogg.Image"></label>
		<input asp-for="BloggImage" class="form-control" />
		<span asp-validation-for="NewBlogg.Image" class="text-danger"></span>
		<br />
		@if (!string.IsNullOrEmpty(Model.NewBlogg.Image))
		{
			<div class="mb-3">
				<label>Nuvarande bild: </label><br />
				<img src="~/img/@Model.NewBlogg.Image" alt="Miniatyr" style="max-width: 150px; border-radius: 5px;" />
			</div>
		}
		else
		{
			<p>Ingen bild vald.</p>
		}
		<label>@Model.NewBlogg.Image </label><br /><br />

		<input asp-for="NewBlogg" type="submit" class="btn btn-success" value="Skapa ny blogg/spara ändringar" />
	</form>
	</div>
	<br />

	<hr class="m-1 border" />
	<br />

	// LISTA DOLDA BLOGGAR
	<h2>Lista Dolda Bloggar</h2>
	@if (Model.Bloggs != null && Model.Bloggs.Any(b => b.Hidden))
	{
		<table class="border table table-striped shadow-sm">
			<thead>
				<tr>
					<th class="text-center align-middle border" colspan="3">Knappar</th>
					<th class="text-center align-middle border">Id</th>
					<th class="text-center align-middle border">Titel</th>
					<th class="text-center align-middle border">Innehåll</th>
					<th class="text-center align-middle border">Författare</th>
					<th class="text-center align-middle border">Lanserings Datum</th>
					<th class="text-center align-middle border">Bild</th>
				</tr>
			</thead>
			@foreach (var blogg in Model.Bloggs.Where(b => b.Hidden))
			{
				<tr>
					<td class="text-center align-middle">
						<form method="get">
							<input type="hidden" name="deleteId" value="@blogg.Id" />
							<button type="submit" class="btn btn-outline-danger linebreaknormal">Ta bort</button>
						</form>
					</td>
					<td class="text-center align-middle">
						<a asp-route-hiddenId="@blogg.Id" class="btn btn-outline-success">Visa</a>
					</td>
					<td class="text-center align-middle"><a asp-route-editId="@blogg.Id" class="btn btn-outline-primary">Ändra</a></td>

					<td class="text-center align-middle border">@blogg.Id</td>
					<td class="text-lg-start align-middle border">@blogg.Title</td>
					<td class="text-lg-start align-middle border">@blogg.Content.LimitLength(10)</td>
					<td class="text-center align-middle border">@blogg.Author</td>
					<td class="text-center align-middle border">
						<span style="color: @(blogg.LaunchDate.Date > DateTime.Today ? "orange" : "green")">
							@blogg.LaunchDate.ToString("yyyy-MM-dd")
						</span>
					</td>
					<td class="text-center align-middle border">
						<img class="card-img-bottom admin-blog-img" src="~/img/@blogg.Image" />
					</td>
				</tr>
			}
		</table>
	}
	else
	{
		<p>Ingen dold blogg finns att visa.</p>
	}
}
else
{
	<p class="text-danger">Du måste vara inloggad för att komma åt denna sida.</p>
}